02-04-2025 18:43
Status: #idea
Tags: [[WordPress]]

# WordPress Vulnerability Library

Aquí organizaré writeups que me encuentre sobre vulnerabilidades encontradas en WordPress Core y plugins.

La clasificación se hará por el tipo de ataque, y la importancia que esta vulnerabilidad tenga.

En WordPress normalmente no se muestra el código vulnerable, en los CVE, ya que Wordfence y Pathstack lo suelen omitir, pero se puede buscar el plugin directamente y analizar el código.

## Arbitrary File Upload

Este tipo de vulnerabilidades suele aparecer si no se valida el tipo de ficheros que se permite subir a los usuarios, es decir, no se valida si se sube un fichero .php, cuando se puede estar pidiendo un archivo .jpg. Esto permite en muchos casos, que usuarios no autenticados, consigan RCE dentro de nuestro servidor.

### Front-End-Only-Users <= 3.2.32

**Fecha**: 1 de abril de 2025.
CVE: [CVE-2025-2005](https://www.cve.org/CVERecord?id=CVE-2025-2005)
CVSS: **9.8 (Critical)**

Al no validar la extensión del fichero que se sube en una field opcional que permite la subida de ficheros, se puede llegar a conseguir RCE en el servidor.

El código inseguro, sería este:

```php
if (!isset($msg)) { $msg = "";}
$msg .= $_FILES[$Field_Name]['name'];

$filetype = wp_check_filetype( $_FILES[$Field_Name]['name'] );

if ( $validate['type'] !== false ) {

	$upload_dir = wp_upload_dir();

	//for security reason, we force to remove all uploaded file
	
	$target_path = $upload_dir['path'] . '/ewd-feup-user-uploads/';

	//create the uploads directory if it doesn't exist
	
	if (!file_exists($target_path)) {
	
		mkdir($target_path, 0777, true);
	
	}

	$Random = EWD_FEUP_RandomString();
	
	$target_path = $target_path . $Random . basename( $_FILES[$Field_Name]['name']);
	
	if (!move_uploaded_file($_FILES[$Field_Name]['tmp_name'], $target_path)) {
	
	//if (!$upload = wp_upload_bits($_FILES["Item_Image"]["name"], null, file_get_contents($_FILES["Item_Image"]["tmp_name"]))) {
	
	$error .= "There was an error uploading the file, please try again!";
	} else {
		$User_Upload_File_Name = $Random . basename( $_FILES[$Field_Name]  ['name']);
	}

} else {
	$error .= "File type not allowed.";
}
```

Vemos como se sube a la carpeta ewd-feup-user-uploads, y a partir de ahí, tendríamos que forzar una string random que genera la función EWD_FEUP_RandomString:

```php
function EWD_FEUP_RandomString($CharLength = 10)
{
	$characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
	
	$randstring = '';

	for ($i = 0; $i < $CharLength; $i++) {
		$randstring .= $characters[rand(0, strlen($characters)-1)];
	}
	
	return $randstring;
}
```


---
# Backlinks

```dataview
LIST
FROM [[]]
SORT file.name ASC
```
