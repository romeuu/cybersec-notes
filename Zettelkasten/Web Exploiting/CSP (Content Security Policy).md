25-01-2025 12:35
Status: #idea
Tags: [[Web Exploiting]]

# CSP (Content Security Policy)

El **CSP (Content Security Policy)** es un mecanismo de seguridad que permite a los desarrolladores controlar qué recursos (como scripts, estilos, imágenes, etc.) pueden ser cargados y ejecutados en una página web. No se limita solo a JavaScript, ni es simplemente una lista de sitios web permitidos.

- **CSP** es una política de seguridad que se implementa mediante una cabecera HTTP (`Content-Security-Policy`) o una etiqueta `<meta>` en el HTML.

- Permite restringir el origen de los recursos que se pueden cargar en una página, como scripts, estilos, fuentes, imágenes, iframes, etc.

- Para JavaScript, por ejemplo, puedes especificar desde qué dominios se permiten cargar y ejecutar scripts usando la directiva `script-src`.

- También puede prevenir la ejecución de scripts en línea (`inline scripts`) y `eval`, lo que ayuda a mitigar ataques como **XSS (Cross-Site Scripting)**.

Para ver que CSP tiene nuestro objetivo, tendremos que mirar la header Content-Security-Policy.

## Bypasses

### URI Scheme

Si por ejemplo, en el CSP se especifica algo como: script-src 'self' redacted.com data:, podríamos hacer algún payload como:

````html
<script src=data:text/javascript,alert(1)></script>
````

## JSONP

Si vemos que nuestro sitio web tiene un CSP como: script-src 'self' redacted1.com redacted2.com redacted3.com, podríamos usar JSONP para vulnerar el CSP.

Por ejemplo, YouTube tiene una URL especial para callbacks, en el parámetro callback podemos poner lo que queramos para crear nuestra payload:

https://youtube.com/oembed?url=https://www.youtube.com/watch?v=Z_Kk1zf16l4&callback=alert(1)

Esto nos permitirá hacer nuestra payload XSS de la siguiente manera:

````html
<script/src=https://youtube.com/oembed?url=https://www.youtube.com/watch?v=Z_Kk1zf16l4&callback=alert(1)></script>
`````

Para buscar CSP bypass de otras páginas grandes podremos usar esta [guía de HackTricks](https://hacktricks.boitatech.com.br/pentesting-web/content-security-policy-csp-bypass), o para tener [HackTricks en local](https://github.com/HackTricks-wiki/hacktricks), o simplemente buscar en Google "redacted.com CSP Bypass".

---
# Backlinks

```dataview
LIST
FROM [[]]
SORT file.name ASC
```
